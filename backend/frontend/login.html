<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AGROLINK-AI ‚Äî Login</title>

<style>
    body { margin:0;background:#e1f4e3;font-family:Segoe UI, sans-serif;display:flex;justify-content:center;align-items:center;height:100vh; }
    .container{background:white;width:350px;padding:25px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.15);text-align:center;}
    .logo{font-size:40px;}
    .title{font-size:25px;font-weight:700;color:#1b8a28;margin-bottom:10px;}
    .input-box,.select-box{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:1px solid #b7d8b9;font-size:15px;}
    .btn{width:100%;padding:12px;margin-top:18px;background:#1b8a28;color:white;border:none;border-radius:8px;font-size:17px;cursor:pointer;}
    .btn:hover{background:#166d20;}
</style>
</head>

<body>
<div class="container">
    <div class="logo">üåæ</div>
    <div class="title">AGROLINK-AI</div>

    <form id="loginForm">
        <input id="username" class="input-box" placeholder="Username" required>
        <input id="password" type="password" class="input-box" placeholder="Password" required>

        <select id="role" class="select-box">
            <option value="farmer">üë®‚Äçüåæ Farmer</option>
            <option value="consumer">üßë‚Äçü§ù‚Äçüßë Consumer</option>
        </select>

        <button class="btn" type="submit">Login</button>
    </form>
</div>

<script>
const API = "https://agrolink-ai-1.onrender.com/api/auth";

// If already logged in ‚Üí redirect to dashboard
const saved = localStorage.getItem("agro_user");
if (saved) {
    const u = JSON.parse(saved);
    if (u.role === "farmer") window.location.href = "farmer_dashboard.html";
    else window.location.href = "consumer_dashboard.html";
}

document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    // Call backend API
    const res = await fetch(`${API}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (!res.ok) {
        alert(data.error || "Invalid login");
        return;
    }

    // Save token + role
    localStorage.setItem("agro_user", JSON.stringify({
        token: data.token,
        username: data.user.username,
        role: data.user.role
    }));

    if (data.user.role === "farmer") {
        window.location.href = "farmer_dashboard.html";
    } else {
        window.location.href = "consumer_dashboard.html";
    }
});
</script>

</body>
</html>
